!function(){$.fn.glDatePicker=function(a){var b="glDatePicker",c=this.data(b);return c?a===!0?c:this:this.each(function(){return $(this).data(b,new glDatePicker(this,a))})},$.fn.glDatePicker.defaults={cssName:"default",zIndex:1e3,borderSize:1,calendarOffset:{x:0,y:1},showAlways:!1,hideOnClick:!0,allowMonthSelect:!0,allowYearSelect:!0,todayDate:new Date,selectedDate:null,prevArrow:"◄",nextArrow:"►",selectableDates:null,selectableDateRange:null,specialDates:null,selectableMonths:null,selectableYearOffset:[5,10],selectableYears:null,selectableDOW:null,monthNames:null,dowNames:null,dowOffset:0,onClick:function(a,b,c){a.val(c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()),a.change()},onHover:function(){},onShow:function(a){a.show()},onHide:function(a){a.hide()},firstDate:null};var glDatePicker=function(){function glDatePicker(a,b){var d,e,c=this;c.el=$(a),d=c.el,c.options=$.extend(!0,{},$.fn.glDatePicker.defaults,b),e=c.options,c.calendar=$($.find("[gldp-el="+d.attr("gldp-id")+" ]")),e.selectedDate=e.selectedDate||e.todayDate,e.firstDate=new Date(e.firstDate||e.selectedDate)._first(),(d.attr("gldp-id")||"").length||d.attr("gldp-id","gldp-"+Math.round(1e10*Math.random())),d.addClass("gldp-el").bind("click",function(a){c.show(a)}).bind("focus",function(a){c.show(a)}),c.calendar.length&&!e.showAlways&&c.calendar.hide(),$(document).bind("mouseup",function(a){var b=a.target,e=c.calendar;d.is(b)||e.is(b)||0!==e.has(b).length||!e.is(":visible")||c.hide()}),c.render()}return glDatePicker.prototype={show:function(){$.each($(".gldp-el").not(this.el),function(a,b){b.length&&b.options.onHide(b.calendar)}),this.options.onShow(this.calendar)},hide:function(){this.options&&!this.options.showAlways&&this.options.onHide(this.calendar)},relocate:function(){var a=this,b=a.el,c=a.options,d=a.calendar,e=b.offset();d.css({top:e.top+b.outerHeight()+c.calendarOffset.y+"px",left:e.left+c.calendarOffset.x+"px"})},render:function(renderCalback){var onResize,cellCSS,setFirstDate,getFirstDate,prevFirstDate,nextFirstDate,firstDate,firstDateVal,firstDateMonth,firstDateYear,startDate,dowOffset,startOffset,showPrev,showNext,monyearClass,prevCell,titleCellCount,titleWidth,titleCell,nextCell,row,cellIndex,col,cellDate,cellClass,cellZIndex,cell,cellDateVal,cellDateTime,specialData,isSelectable,getRepeatDate,toggleYearMonthSelect,onYearMonthSelect,monthSelect,yearSelect,monthText,yearText,titleYearMonth,self=this,el=self.el,options=self.options,calendar=self.calendar,coreClass=" core border ",cssName="gldp-"+options.cssName,todayVal=options.todayDate._val(),todayTime=todayVal.time,maxRow=6,maxCol=7,borderSize=options.borderSize+"px",getSelectableList=function(a,b,c){var e,f,d=[];for(e=a;b>=e;e++)d.push(e);return c&&(f=[],$.each(c,function(c,d){d>=a&&b>=d&&f._indexOf(d)<0&&f.push(d)}),d=f.length?f:d),d.sort(),d},selectableMonths=getSelectableList(0,11,options.selectableMonths),selectableYears=getSelectableList(todayVal.year-options.selectableYearOffset[0],todayVal.year+options.selectableYearOffset[1],options.selectableYears),selectableDOW=getSelectableList(0,6,options.selectableDOW),dowNames=options.dowNames||["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames=options.monthNames||["January","February","March","April","May","June","July","August","September","October","November","December"],containerWidth=el.outerWidth(),containerHeight=containerWidth,getCellSize=function(a,b){return a/b+options.borderSize/b*(b-1)},cellWidth=getCellSize(containerWidth,maxCol),cellHeight=getCellSize(containerHeight,maxRow+2);for(calendar.length?eval(calendar.data("is"))||(containerWidth=calendar.outerWidth(),containerHeight=calendar.outerHeight(),cellWidth=getCellSize(containerWidth,maxCol),cellHeight=getCellSize(containerHeight,maxRow+2)):(self.calendar=calendar=$("<div/>").attr("gldp-el",el.attr("gldp-id")).data("is",!0).css({display:options.showAlways?void 0:"none",zIndex:options.zIndex,width:cellWidth*maxCol+"px"}),$("body").append(calendar)),el.is(":visible")||calendar.hide(),calendar.removeClass().addClass(cssName).children().remove(),onResize=function(){var a=el.offset();calendar.css({top:a.top+el.outerHeight()+options.calendarOffset.y+"px",left:a.left+options.calendarOffset.x+"px"})},$(window).resize(onResize),onResize(),cellCSS={width:cellWidth+"px",height:cellHeight+"px",lineHeight:cellHeight+"px"},setFirstDate=function(a){a&&(options.firstDate=a,self.render())},getFirstDate=function(a){var c,d,e,b=new Date(options.firstDate);for(a=a||0;;){if(b.setMonth(b.getMonth()+a),b.setDate(Math.min(1,b._max())),0==a)break;if(c=b._val(),d=c.month,e=c.year,-1!=selectableMonths._indexOf(d)){if(-1!=selectableYears._indexOf(e))break;if(e<selectableYears[0]||e>selectableYears[selectableYears.length-1])return null}}return b},prevFirstDate=getFirstDate(-1),nextFirstDate=getFirstDate(1),firstDate=options.firstDate=getFirstDate(),firstDateVal=firstDate._val(),firstDateMonth=firstDateVal.month,firstDateYear=firstDateVal.year,startDate=new Date(firstDate),dowOffset=Math.abs(Math.min(6,Math.max(0,options.dowOffset))),startOffset=startDate.getDay()-dowOffset,startOffset=1>startOffset?-7-startOffset:-startOffset,dowNames=dowNames.concat(dowNames).slice(dowOffset,dowOffset+7),startDate._add(startOffset),showPrev=prevFirstDate,showNext=nextFirstDate,monyearClass=coreClass+"monyear ",prevCell=$("<div/>").addClass(monyearClass).css($.extend({},cellCSS,{borderWidth:borderSize+" 0 0 "+borderSize})).append($("<a/>").addClass("prev-arrow"+(showPrev?"":"-off")).html(options.prevArrow)).mousedown(function(){return!1}).click(function(a){""!=options.prevArrow&&showPrev&&(a.stopPropagation(),setFirstDate(prevFirstDate))}),titleCellCount=maxCol-2,titleWidth=cellWidth*titleCellCount-titleCellCount*options.borderSize+options.borderSize,titleCell=$("<div/>").addClass(monyearClass+"title").css($.extend({},cellCSS,{width:titleWidth+"px",borderTopWidth:borderSize,marginLeft:"-"+borderSize})),nextCell=$("<div/>").addClass(monyearClass).css($.extend({},cellCSS,{marginLeft:"-"+borderSize,borderWidth:borderSize+" "+borderSize+" 0 0"})).append($("<a/>").addClass("next-arrow"+(showNext?"":"-off")).html(options.nextArrow)).mousedown(function(){return!1}).click(function(a){""!=options.nextArrow&&showNext&&(a.stopPropagation(),setFirstDate(nextFirstDate))}),calendar.append(prevCell).append(titleCell).append(nextCell),row=0,cellIndex=0;maxRow+1>row;row++)for(col=0;maxCol>col;col++,cellIndex++)cellDate=new Date(startDate),cellClass="day",cellZIndex=options.zIndex+cellIndex,cell=$("<div/>"),row?(cellDate._add(col+(row-1)*maxCol),cellDateVal=cellDate._val(),cellDateTime=cellDateVal.time,specialData=null,isSelectable=!0,getRepeatDate=function(a,b){return a.repeatYear===!0&&b.setYear(cellDateVal.year),a.repeatMonth===!0&&b.setMonth(cellDateVal.month),b._val()},cell.html(cellDateVal.date),options.selectableDateRange&&(isSelectable=!1,$.each(options.selectableDateRange,function(a,b){var c=b.from,d=b.to||null;return d=d||new Date(b.from.getFullYear(),b.from.getMonth(),b.from._max()),c=getRepeatDate(b,c),d=getRepeatDate(b,d),cellDateTime>=c.time&&cellDateTime<=d.time?(isSelectable=!0,!0):void 0})),options.selectableDates&&((options.selectableDateRange&&!isSelectable||isSelectable&&!options.selectableDateRange)&&(isSelectable=!1),$.each(options.selectableDates,function(a,b){var c=getRepeatDate(b,b.date);return c.time==cellDateTime?isSelectable=!0:void 0})),!isSelectable||selectableYears._indexOf(cellDateVal.year)<0||selectableMonths._indexOf(cellDateVal.month)<0||selectableDOW._indexOf(cellDateVal.day)<0?cellClass="noday":(cellClass=["sun","mon","tue","wed","thu","fri","sat"][cellDateVal.day],firstDateMonth!=cellDateVal.month&&(cellClass+=" outday"),todayTime==cellDateTime&&(cellClass="today",cellZIndex+=50),options.selectedDate._time()==cellDateTime&&(cellClass="selected",cellZIndex+=51),options.specialDates&&$.each(options.specialDates,function(a,b){var c=getRepeatDate(b,b.date);c.time==cellDateTime&&(cellClass=b.cssClass||"special",cellZIndex+=52,specialData=b.data)}),cell.mousedown(function(){return!1}).hover(function(a){a.stopPropagation();var b=$(this).data("data");options.onHover(el,cell,b.date,b.data)}).click(function(a){a.stopPropagation();var b=$(this).data("data");options.selectedDate=options.firstDate=b.date,self.render(function(){!options.showAlways&&options.hideOnClick&&self.hide()}),options.onClick(el,$(this),b.date,b.data)}))):(cellClass="dow",cell.html(dowNames[col]),cellDate=null),$.extend(cellCSS,{borderTopWidth:borderSize,borderBottomWidth:borderSize,borderLeftWidth:row>0||!row&&!col?borderSize:0,borderRightWidth:row>0||!row&&6==col?borderSize:0,marginLeft:col>0?"-"+borderSize:0,marginTop:row>0?"-"+borderSize:0,zIndex:cellZIndex}),cell.data("data",{date:cellDate,data:specialData}).addClass(coreClass+cellClass).css(cellCSS),calendar.append(cell);toggleYearMonthSelect=function(a){var b="inline-block",c="none";options.allowMonthSelect&&(monthText.css({display:a?b:c}),monthSelect.css({display:a?c:b})),options.allowYearSelect&&(yearText.css({display:a?c:b}),yearSelect.css({display:a?b:c}))},onYearMonthSelect=function(){options.firstDate=new Date(yearSelect.val(),monthSelect.val(),1),self.render()},monthSelect=$("<select/>").hide().change(onYearMonthSelect),yearSelect=$("<select/>").hide().change(onYearMonthSelect),monthText=$("<span/>").html(monthNames[firstDateMonth]).mousedown(function(){return!1}).click(function(a){a.stopPropagation(),toggleYearMonthSelect(!1)}),yearText=$("<span/>").html(firstDateYear).mousedown(function(){return!1}).click(function(a){a.stopPropagation(),toggleYearMonthSelect(!0)}),$.each(monthNames,function(a,b){if(options.allowMonthSelect&&-1!=selectableMonths._indexOf(a)){var c=$("<option/>").html(b).attr("value",a);a==firstDateMonth&&c.attr("selected","selected"),monthSelect.append(c)}}),$.each(selectableYears,function(a,b){if(options.allowYearSelect){var c=$("<option/>").html(b).attr("value",b);b==firstDateYear&&c.attr("selected","selected"),yearSelect.append(c)}}),titleYearMonth=$("<div/>").append(monthText).append(monthSelect).append(yearText).append(yearSelect),titleCell.children().remove(),titleCell.append(titleYearMonth),renderCalback=renderCalback||function(){},renderCalback()}},glDatePicker}();!function(){Date.prototype._clear=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype._time=function(){return this._clear().getTime()},Date.prototype._max=function(){var a=1==new Date(this.getYear(),1,29).getMonth()?1:0,b=[31,28+a,31,30,31,30,31,31,30,31,30,31];return b[this.getMonth()]},Date.prototype._add=function(a){this.setDate(this.getDate()+a)},Date.prototype._first=function(){var a=new Date(this);return a.setDate(1),a},Date.prototype._val=function(){return this._clear(),{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),day:this.getDay()}},Array.prototype._indexOf=function(a){return $.inArray(a,this)}}()}();